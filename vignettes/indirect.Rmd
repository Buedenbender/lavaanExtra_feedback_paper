---
title: "Automatic indirect effects"
author: "Rémi Thériault"
date: "August 29, 2022"
output:
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{Automatic indirect effects}
  %\VignetteEngine{knitr::knitr}
---

This article demonstrates ways to produce indirect effects automatically for different scenarios. This is an experimental feature and does not support all scenarios. Progress for more scenarios will be implemented progressively. If using this feature, always triple check that your model was specified correctly.

```{r, message = FALSE}
library(lavaan)
library(lavaanExtra)
```

# 1 mediator, 2 IVs

```{r}
# Calculate scale averages
data <- HolzingerSwineford1939
data$visual <- rowMeans(data[paste0("x", 1:3)])
data$textual <- rowMeans(data[paste0("x", 4:6)])
data$speed <- rowMeans(data[paste0("x", 7:9)])

# Define our variables
IV <- c("ageyr", "grade")
M <- "visual"
DV <- c("speed", "textual")

# Define our lavaan lists
mediation <- list(speed = M, textual = M, visual = IV)
regression <- list(speed = IV, textual = IV)

# Define indirect object
indirect <- list(M = M, DV = DV, IV = IV)

# Write the model, and check it
model1 <- write_lavaan(mediation, regression, indirect = indirect, label = TRUE)
cat(model1)

# Fit and plot
fit1 <- lavaan(model1, data = data, auto.cov.lv.x = TRUE,
               auto.var = TRUE, auto.fix.first = TRUE)
nice_lavaanPlot(fit1)
```

# 2 mediators, 1 IV

```{r}
# Define our variables
IV <- "ageyr"
M <- c("visual", "grade")

# Define our lavaan lists
mediation <- list(speed = M, textual = M, visual = IV, grade = IV)
regression <- list(speed = IV, textual = IV)

# Define indirect object
indirect <- list(IV = IV, M = M, DV = DV)

# Write the model, and check it
model2 <- write_lavaan(mediation, regression, indirect = indirect, label = TRUE)
cat(model2)

# Fit and plot
fit2 <- lavaan(model2, data = data, auto.cov.lv.x = TRUE,
               auto.var = TRUE, auto.fix.first = TRUE)
nice_lavaanPlot(fit2)
```

# 2 mediators, 2 IVs

```{r}
# Define our variables
IV <- c("sex", "ageyr")

# Define our lavaan lists
mediation <- list(speed = M, textual = M, visual = IV, grade = IV)
regression <- list(speed = IV, textual = IV)

# Define indirect object
indirect <- list(IV = IV, M = M, DV = DV)

# Write the model, and check it
model3 <- write_lavaan(mediation, regression, indirect = indirect, label = TRUE)
cat(model3)

# Fit and plot
fit3 <- lavaan(model3, data = data, auto.cov.lv.x = TRUE,
               auto.var = TRUE, auto.fix.first = TRUE)
nice_lavaanPlot(fit3)
```

# 2 mediators, 3 IVs

```{r}
# Define our variables
IV <- c("sex", "ageyr", "agemo")

# Define our lavaan lists
mediation <- list(speed = M, textual = M, visual = IV, grade = IV)
regression <- list(speed = IV, textual = IV)

# Define indirect object
indirect <- list(IV = IV, M = M, DV = DV)

# Write the model, and check it
model4 <- write_lavaan(mediation, regression, indirect = indirect, label = TRUE)
cat(model4)

# Fit and plot
fit4 <- lavaan(model4, data = data, auto.cov.lv.x = TRUE,
               auto.var = TRUE, auto.fix.first = TRUE)
nice_lavaanPlot(fit4)
```

# 2 mediators, 6 IVs

```{r}
# Define our variables
IV <- c("sex", "ageyr", "agemo", "school", "x2", "x3")

# Define our lavaan lists
mediation <- list(speed = M, textual = M, visual = IV, grade = IV)
regression <- list(speed = IV, textual = IV)

# Define indirect object
indirect <- list(IV = IV, M = M, DV = DV)

# Write the model, and check it
model5 <- write_lavaan(mediation, regression, indirect = indirect, label = TRUE)
cat(model5)

# Fit and plot
fit5 <- lavaan(model5, data = data, auto.cov.lv.x = TRUE,
               auto.var = TRUE, auto.fix.first = TRUE)
nice_lavaanPlot(fit5)
```


# Other scenarios

If you experience any issues with other scenarios, please open a GitHub issue with your example, and I will try to adapt the function to support that case. Thank you!
